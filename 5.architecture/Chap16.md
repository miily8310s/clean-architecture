# 第１６章 独立性

- 優れたソフトウェアアーキテクトは初歌のことをサポートしなければいけない
  - システムのユースケース
  - システムの運用
  - システムの開発
  - システムのデプロイ

## ユースケース

- ユースケース：アーキテクチャがシステムの意図をサポートしなければ行けないことを意味している
- ショッピングカートのアプリケーションを例にしてみる
  - アーキテクチャはショッピングカートのユースケースをサポートしなければいけない
  - 優れたアーキテクチャを備えているバア、ショッピングカートのアプリケーションのように**見える**
    - システムのユースケースは、システムの構造のなかにハッキリと見えるようになる
      - 開発者は振る舞いを探すことがなくなる
    - 振る舞いはファーストクラスの要素（クラス、関数、モジュールなどがある）として、システムのトップレベルにあり、アーキテクチャでは目立った位置にいる
    - また、ユースケースにはそれぞれの機能で明確に名前が付けられている

## 運用

- アーキテクチャは、システムの運用において、表面的よりも本質的な役割を果たす
- 特定の技術を想定しないアーキテクチャならば、システムの運用ニーズの変化に合わせての移行が比較的簡単になる

## 開発

- チームの多い組織では、開発中にチームがお互いに鑑賞しないように、それぞれのチームの行動を独立させるアーキテクチャをシステムに持たせる必要がある
  - → 単独で開発可能なコンポーネントにシステムを適切に分割しなればいけない
  - → 分割したコンポーネントをそれぞれのチームに割り当てる

## デプロイ

- アーキテクチャは、デプロイの手軽さの決定にも大きな役割を果たす
- 優れたアーキテクチャならば、プロパティファイルの変更や、ファイルを手作業で作成して用意する必要がなく、構築後すぐにシステムをデプロイできる

## 選択肢を残しておく

- 優れたアーキテクチャには…バランスを上手く取ることができる、を言うのは簡単
- 実際このバランスを取ることは難しく、目指すべき目標は不明瞭で一貫性がないになりがち
- だが、目指すべき目標が不明瞭でも、比較安価に実装することができ、バランスを上手く取ることができるアーキテクチャの原則もある
  - システムを独立したコンポーネントに分割できる

## レイヤーの切り離し

- アーキテクトは、すべてのユースケースを把握することは出来ない
- ただし、システムの基本的な意図は**把握出来ている**
  - 例）これはショッピングカートのシステム、あれは注文処理システムといった具合
- *単一責任の原則（SRP）*と*閉鎖性共通の原則（CCP）*を使用して、異なる理由で変更されるものを分離し、同じ理由で変更されるものをまとめる
- 異なる理由で変更するものは何か？
  - 明らかに理由が異なるもの：UI 部分とビジネスルール部分
  - ビジネスルールも、アプリケーションに密接に結びついているものもあれば、一般的なものもある
    - 講座の利率計算・在庫の計算：そのドメインに密接に結びついている
    - 入力フィールドの検証：アプリケーションに密接に結びついている
    - → この２種類のルールは異なる理由で変更されるため、独立して変更できるように分離すべき
  - データベースやスキーマなども、ビジネスルールや UI とは関係ないため同様に分離すべき
- システムは切り離れている水平レイヤーで分離されている
  - 例）UI、アプリケーション特有のビジネスルール、アプリケーションに依存しないビジネスルール、データベースなど

## ユースケースの切り離し

- ユースケースはシステムを分割する自然な方法であり、システムの水平レイヤーを薄く垂直にスライスしたもの
- 変更する理由の違いでシステムの要素を切り離しておくと、古いユースケースに影響を与えずに新しいユースケースを追加できる

## 切り離し方式

- ユースケースの切り離しは、運用にも適用可能
  - UI とデータベースがビジネスルールから分離されていれば、異なるサーバーで実行することができる
  - その場合、何らかの通信手段でお互いやり取りをすることに成る
  - アーキテクトは、こうしたコンポーネントを「サービス」または「マイクロサービス」と呼んでいる
- ただし、優れたアーキテクトは選択肢を残しておくもの。こうした**切り離し方式も選択肢の一つ**、「マイクロサービス」のビッグウェーブに乗る必要はない
